var X=Object.defineProperty;var I=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var M=(n,t,o)=>t in n?X(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,y=(n,t)=>{for(var o in t||(t={}))V.call(t,o)&&M(n,o,t[o]);if(I)for(var o of I(t))z.call(t,o)&&M(n,o,t[o]);return n};var Y=(n,t)=>{var o={};for(var s in n)V.call(n,s)&&t.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&I)for(var s of I(n))t.indexOf(s)<0&&z.call(n,s)&&(o[s]=n[s]);return o};import{c as L,S as P,r as k,R as e,l as Z,n as ee,a as te,b as ne,H as $,i as oe,m as re,F as se,d as q,e as ae,B as ce,f as le,g as ie}from"./vendor.f0d91e7a.js";const ue=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerpolicy&&(c.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?c.credentials="include":r.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}};ue();const de=(n,t)=>{n.emit("command",t)};var x={send:de};const A={isClosable:!0,duration:5e3,position:"top"},me={status:"error",title:"Oops"},fe={status:"success",title:"Success!!"},pe=L({defaultOptions:A}),ge=L({defaultOptions:y(y({},A),me)}),he=L({defaultOptions:y(y({},A),fe)});var h={toast:pe,error:ge,success:he};const U=P.mixin({buttonsStyling:!1,width:"20rem"}),G=()=>{const n=U.getPopup();return n.classList.remove("swal2-show"),setTimeout(()=>{n.classList.add("animate__animated","animate__headShake")}),setTimeout(()=>{n.classList.remove("animate__animated","animate__headShake")},500),!1},we=({partner:n,onAccept:t,onDeny:o})=>{U.fire({title:n,html:"<p class='text-indigo-500 text-base font-light'>Incoming Call<p>",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"accept",cancelButtonText:"deny",reverseButtons:!0,allowOutsideClick:G,backdrop:!0,imageUrl:"/images/call/waving-hand.gif",customClass:{popup:"rounded-lg",image:"w-24 h-24 mt-3 mb-0",title:"font-semibold text-2xl text-indigo-700 mt-0 mb-0",htmlContainer:"pt-0",cancelButton:"w-32 h-14 rounded-lg bg-yellow-500 text-white focus:outline-none mr-3",confirmButton:"w-32 h-14 rounded-lg bg-indigo-700 text-white focus:outline-none ml-3"}}).then(s=>{s.isConfirmed?t():s.dismiss===P.DismissReason.cancel&&o()})},xe=({partner:n,onCancel:t})=>{U.fire({title:n,html:"<p class='text-indigo-700 text-base font-light'>calling<p>",showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Cancel Call",reverseButtons:!1,allowOutsideClick:G,backdrop:!0,imageUrl:"/images/call/call-me-hand.gif",customClass:{popup:"rounded-lg",image:"w-24 h-24 mt-3 mb-0",title:"font-semibold text-2xl text-indigo-700 mt-0 mb-0",htmlContainer:"pt-0",cancelButton:"w-72 h-14 rounded-lg bg-yellow-500 text-white focus:outline-none"}}).then(o=>{o.dismiss===P.DismissReason.cancel&&t()})};var R={swalBootstrapBtn:U,incomingCall:we,dialingCall:xe};const Ce={username:"",updateUsername:()=>{},friendname:"",updateFriendname:()=>{}},K=k.exports.createContext(Ce),_=()=>k.exports.useContext(K),be=({children:n})=>{const[t,o]=k.exports.useState(""),[s,r]=k.exports.useState(""),d={username:t,updateUsername:m=>{o(m)},friendname:s,updateFriendname:m=>{r(m)}};return e.createElement(K.Provider,{value:d},n)},w=Z({autoConnect:!1,withCredentials:!0});w.onAny((n,...t)=>{let o=null;try{o=t[0].type}finally{console.log(`${n}${o?`:${o}`:""}`,t)}});w.on("connect_error",n=>{console.error("connect_error",n.message),h.error({description:n.message})});w.on("response",n=>{n.type==="socket-connect"&&h.success({description:n.content.description})});const Ee={socket:w,isSocketConnected:!1},J=k.exports.createContext(Ee),j=()=>k.exports.useContext(J),ve=({children:n})=>{const[t,o]=e.useState(!1),s={socket:w,isSocketConnected:t},r=d=>{t&&(d.returnValue="You will lose your connection to the socket!")},c=()=>{o(!0)},u=()=>{o(!1)};return e.useEffect(()=>(w.on("connect",c),w.on("disconnect",u),()=>{w.off("connect",c),w.off("disconnect",u)}),[]),e.useEffect(()=>(window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}),[t]),e.createElement(J.Provider,{value:s},n)},Q=({labelText:n,name:t,buttonText:o,placeholder:s,handleInputChange:r,buttonAction:c,isUserForm:u=!0,generateUsername:d})=>e.createElement("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},e.createElement("div",{className:"bg-white py-8 px-6 shadow rounded-lg sm:px-10"},e.createElement("form",{className:"mb-0 space-y-6",onSubmit:m=>{m.preventDefault()}},e.createElement("div",null,e.createElement("div",null,e.createElement("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700"},n,e.createElement("div",{className:"mt-1"},e.createElement("input",{onChange:r,value:t,className:"w-full border border-gray-300 rounded-lg shadow-sm focus:outline-none px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",type:"text",name:"username",placeholder:s,id:"userId"}))))),e.createElement("div",null,e.createElement("button",{onClick:c,type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},o)),u?e.createElement("div",null,e.createElement("button",{onClick:d,type:"button",className:"w-full flex justify-center py-2 px-4 border border-indigo-700 rounded-md shadow-sm text-sm font-medium text-indigo-700 bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"Generate a username")):null))),ye={dictionaries:[ee,te,ne],separator:"",length:2},ke=({history:n})=>{const{socket:t,isSocketConnected:o}=j(),{username:s,friendname:r,updateUsername:c,updateFriendname:u}=_(),[d,m]=e.useState(""),[i,f]=e.useState(!1),[N,C]=e.useState(!1),[S,b]=e.useState(!1),D=a=>{a.preventDefault(),c(a.target.value)},T=a=>{a.preventDefault(),t.auth={username:s},t.connect()},O=a=>{a.preventDefault(),u(a.target.value)},F=()=>{x.send(t,{type:"call-offer",content:{target:r,cancelling:!0}}),f(!1)},l=()=>{x.send(t,{type:"call-answer",content:{caller:d,accepted:!0}}),b(!0),u(d)},p=()=>{x.send(t,{type:"call-answer",content:{caller:d,accepted:!1}}),m(""),b(!1),C(!1),u("")},E=a=>{if(a.preventDefault(),!o){h.error({description:"You should register first!"});return}f(!0),x.send(t,{type:"call-offer",content:{target:r}})},g=a=>{const{type:W,content:B,success:H}=a;switch(W){case"socket-connect":break;case"call-offer":H?B.cancelling?(m(""),C(!1),R.swalBootstrapBtn.close()):(m(B.caller),C(!0)):(f(!1),h.error({description:B.description}),R.swalBootstrapBtn.close());break;case"call-answer":H?(R.swalBootstrapBtn.close(),C(!1),b(B.accepted),f(!1)):h.error({description:B.description});break}};e.useEffect(()=>(t.on("response",g),()=>{t.off("response",g)}),[]),e.useEffect(()=>{i&&R.dialingCall({partner:r,onCancel:F})},[i,f]),e.useEffect(()=>{N&&R.incomingCall({partner:d,onAccept:l,onDeny:p})},[N,C]),e.useEffect(()=>{S&&n.replace("/room",{isCaller:!!i})},[S,b]);const v=()=>{const a=oe(ye);c(a)};return e.createElement(e.Fragment,null,e.createElement($,null,e.createElement("title",null,"ChatSignal Home")),e.createElement("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 px-6 lg:px-8"},e.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},e.createElement("img",{className:"mx-auto h-12 w-auto",src:"/images/webrtc_logo.svg",alt:"webrtc chat"}),e.createElement("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900"},!!o&&!!s?e.createElement(e.Fragment,null,"Hi\xA0",e.createElement("span",{className:"text-indigo-500"},s)):"Set a username"),!!o&&!!s?e.createElement("p",{className:"text-center text-sm font-medium text-gray-700"},"Try to call someone or wait them to call you"):null),!!o&&!!s?e.createElement(Q,{name:r,handleInputChange:O,buttonAction:E,buttonText:"Call",labelText:"Friend username",placeholder:"e.g. pepsicola",isUserForm:!1}):e.createElement(Q,{name:s,handleInputChange:D,buttonAction:T,buttonText:"Continue",labelText:"Username",placeholder:"e.g. cocacola",isUserForm:!0,generateUsername:v})))},Se={iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]},Be=({location:{state:n},history:t})=>{const{friendname:o,updateFriendname:s}=_(),{socket:r}=j(),[c,u]=e.useState(n.isCaller),d=e.useRef(null),m=e.useRef(null),i=e.useRef(),f=e.useRef();function N(l){l.candidate&&x.send(r,{type:"ice-candidate",content:{friendname:o,candidate:l.candidate}})}function C(l){m.current.srcObject=l.streams[0]}function S(){const l=new RTCPeerConnection(Se);return l.onicecandidate=N,l.ontrack=C,l}function b(){m.current.srcObject=null,i.current.close(),i.current.onicecandidate=null,i.current.ontrack=null,f.current.getTracks().forEach(l=>{l.stop()}),f.current=void 0,i.current=void 0,s(""),t.replace("/")}const D=l=>{const{type:p,success:E,content:g}=l;switch(p){case"peer-offer":if(E){i.current=S();const v=new RTCSessionDescription(g.offer);i.current.setRemoteDescription(v).then(()=>{f.current.getTracks().forEach(a=>{i.current.addTrack(a,f.current)})}).then(()=>i.current.createAnswer()).then(a=>i.current.setLocalDescription(a)).then(()=>{x.send(r,{type:"peer-answer",content:{caller:o,answer:i.current.localDescription}})}).catch(a=>console.log(a))}else h.error({description:g.description});break;case"peer-answer":if(E){const v=new RTCSessionDescription(g.answer);i.current.setRemoteDescription(v).catch(a=>console.log(a))}else h.error({description:g.description});break;case"peer-leave":E?b():h.error({description:g.description});break;case"ice-candidate":if(E){const v=new RTCIceCandidate(g.candidate);i.current.addIceCandidate(v).catch(a=>console.log(a))}else h.error({description:g.description});break}};e.useEffect(()=>(navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(l=>{d.current.srcObject=l,f.current=l,c&&(i.current=S(),i.current.createOffer().then(p=>(i.current.setLocalDescription(p),{target:o,offer:p})).then(p=>{x.send(r,{type:"peer-offer",content:p})}).catch(p=>console.log(p)),f.current.getTracks().forEach(p=>{i.current.addTrack(p,f.current)})),r.on("response",D)}).catch(l=>{console.log(l)}),()=>{r.off("response",D)}),[]);const T=l=>{l.returnValue="You will lose your connection to the socket!"};e.useEffect(()=>(window.addEventListener("beforeunload",T),()=>{window.removeEventListener("beforeunload",T)}),[]);function O(){x.send(r,{type:"peer-leave",content:{target:o}}),b()}const F=e.useRef(null);return e.createElement(e.Fragment,null,e.createElement($,null,e.createElement("title",null,"Chat with\xA0",o)),e.createElement("div",{className:"w-screen h-screen bg-gray-300",ref:F},e.createElement(re.div,{drag:!0,className:"absolute top-2 left-2 z-10",dragConstraints:F,dragElastic:.1,dragPropagation:!0},e.createElement("video",{autoPlay:!0,ref:d,className:"w-40  rounded-lg",muted:!0},e.createElement("track",{kind:"captions"}))),e.createElement("div",{className:"flex items-center justify-center h-full w-full z-0 overflow-hidden"},e.createElement("video",{autoPlay:!0,ref:m,className:"sm:h-full"},e.createElement("track",{kind:"captions"}))),e.createElement("button",{className:"absolute bottom-6 left-[50%] translate-x-[-50%] z-20 p-0 w-12 h-12 bg-red-600 rounded-full hover:bg-red-700 active:shadow-lg mouse shadow transition ease-in duration-200 focus:outline-none",type:"button",onClick:O},e.createElement(se,{className:"w-5 h-5 inline-block text-white"}))))},Re=s=>{var r=s,{isAuthenticated:n,authenticationPath:t}=r,o=Y(r,["isAuthenticated","authenticationPath"]);return n?e.createElement(q,y({},o)):e.createElement(ae,{to:{pathname:t}})},Ne=()=>{const{isSocketConnected:n}=j(),{username:t,friendname:o}=_(),s=n===!0&&!!t&&!!o;return e.createElement(ce,null,e.createElement(le,null,e.createElement(q,{exact:!0,path:"/",component:ke}),e.createElement(Re,{isAuthenticated:s,authenticationPath:"/",path:"/room",component:Be})))},De=()=>e.createElement(ve,null,e.createElement(be,null,e.createElement(Ne,null)));ie.render(e.createElement(e.StrictMode,null,e.createElement(De,null)),document.getElementById("root"));

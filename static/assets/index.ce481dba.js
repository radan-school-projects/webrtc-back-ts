var ee=Object.defineProperty;var O=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var z=(t,n,r)=>n in t?ee(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,k=(t,n)=>{for(var r in n||(n={}))H.call(n,r)&&z(t,r,n[r]);if(O)for(var r of O(n))V.call(n,r)&&z(t,r,n[r]);return t};var M=(t,n)=>{var r={};for(var o in t)H.call(t,o)&&n.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&O)for(var o of O(t))n.indexOf(o)<0&&V.call(t,o)&&(r[o]=t[o]);return r};import{c as L,S as A,r as S,R as e,l as te,n as ne,a as re,b as oe,H as W,i as se,m as ae,F as ce,d as q,e as le,B as ie,f as ue,g as de,C as me}from"./vendor.d366365e.js";const fe=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}};fe();const pe=(t,n)=>{t.emit("command",n)};var v={send:pe};const P={isClosable:!0,duration:5e3,position:"top"},ge={status:"error",title:"Oops"},he={status:"success",title:"Success!!"},we=L({defaultOptions:P}),ve=L({defaultOptions:k(k({},P),ge)}),xe=L({defaultOptions:k(k({},P),he)});var w={toast:we,error:ve,success:xe};const I=A.mixin({buttonsStyling:!1,width:"20rem"}),Y=()=>{const t=I.getPopup();return t.classList.remove("swal2-show"),setTimeout(()=>{t.classList.add("animate__animated","animate__headShake")}),setTimeout(()=>{t.classList.remove("animate__animated","animate__headShake")},500),!1},Ce=({partner:t,onAccept:n,onDeny:r})=>{I.fire({title:t,html:"<p class='text-indigo-500 text-base font-light'>Incoming Call<p>",showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"accept",cancelButtonText:"deny",reverseButtons:!0,allowOutsideClick:Y,backdrop:!0,imageUrl:"/images/call/waving-hand.gif",customClass:{popup:"rounded-lg",image:"w-24 h-24 mt-3 mb-0",title:"font-semibold text-2xl text-indigo-700 mt-0 mb-0",htmlContainer:"pt-0",cancelButton:"w-32 h-14 rounded-lg bg-yellow-500 text-white focus:outline-none mr-3",confirmButton:"w-32 h-14 rounded-lg bg-indigo-700 text-white focus:outline-none ml-3"}}).then(o=>{o.isConfirmed?n():o.dismiss===A.DismissReason.cancel&&r()})},be=({partner:t,onCancel:n})=>{I.fire({title:t,html:"<p class='text-indigo-700 text-base font-light'>calling<p>",showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Cancel Call",reverseButtons:!1,allowOutsideClick:Y,backdrop:!0,imageUrl:"/images/call/call-me-hand.gif",customClass:{popup:"rounded-lg",image:"w-24 h-24 mt-3 mb-0",title:"font-semibold text-2xl text-indigo-700 mt-0 mb-0",htmlContainer:"pt-0",cancelButton:"w-72 h-14 rounded-lg bg-yellow-500 text-white focus:outline-none"}}).then(r=>{r.dismiss===A.DismissReason.cancel&&n()})};var N={swalBootstrapBtn:I,incomingCall:Ce,dialingCall:be};const Ee={username:"",updateUsername:()=>{},friendname:"",updateFriendname:()=>{}},G=S.exports.createContext(Ee),j=()=>S.exports.useContext(G),ye=({children:t})=>{const[n,r]=S.exports.useState(""),[o,s]=S.exports.useState(""),m={username:n,updateUsername:u=>{r(u)},friendname:o,updateFriendname:u=>{s(u)}};return e.createElement(G.Provider,{value:m},t)},R=te({autoConnect:!1,withCredentials:!0});R.onAny((t,...n)=>{let r=null;try{r=n[0].type}finally{console.log(`${t}${r?`:${r}`:""}`,n)}});R.on("connect_error",t=>{console.error("connect_error",t.message),w.error({description:t.message})});R.on("response",t=>{t.type==="socket-connect"&&w.success({description:t.content.description})});const ke={socket:R},K=S.exports.createContext(ke),$=()=>S.exports.useContext(K),Se=({children:t})=>{const n={socket:R},r=o=>{R.connected&&(o.returnValue="You will lose your connection to the socket!")};return e.useEffect(()=>(window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)})),e.createElement(K.Provider,{value:n},t)},J=({labelText:t,name:n,buttonText:r,placeholder:o,handleInputChange:s,buttonAction:a,isUserForm:l=!0,generateUsername:m})=>e.createElement("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},e.createElement("div",{className:"bg-white py-8 px-6 shadow rounded-lg sm:px-10"},e.createElement("form",{className:"mb-0 space-y-6",onSubmit:u=>{u.preventDefault()}},e.createElement("div",null,e.createElement("div",null,e.createElement("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700"},t,e.createElement("div",{className:"mt-1"},e.createElement("input",{onChange:s,value:n,className:"w-full border border-gray-300 rounded-lg shadow-sm focus:outline-none px-3 py-2 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",type:"text",name:"username",placeholder:o,id:"userId"}))))),l?e.createElement("div",null,e.createElement("button",{onClick:m,type:"button",className:"w-full flex justify-center py-2 px-4 border border-indigo-700 rounded-md shadow-sm text-sm font-medium text-indigo-700 bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},"Generate a username")):null,e.createElement("div",null,e.createElement("button",{onClick:a,type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},r))))),Re={dictionaries:[ne,re,oe],separator:"",length:2},Be=({history:t})=>{const{socket:n}=$(),{username:r,friendname:o,updateUsername:s,updateFriendname:a}=j(),[l,m]=e.useState(""),[u,c]=e.useState(!1),[g,x]=e.useState(!1),[T,C]=e.useState(!1),[y,D]=e.useState(n.connected),_=d=>{d.preventDefault(),s(d.target.value)},F=d=>{d.preventDefault(),n.auth={username:r},n.connect()},i=d=>{d.preventDefault(),a(d.target.value)},f=()=>{v.send(n,{type:"call-offer",content:{target:o,cancelling:!0}}),c(!1)},b=()=>{v.send(n,{type:"call-answer",content:{caller:l,accepted:!0}}),C(!0),a(l)},h=()=>{v.send(n,{type:"call-answer",content:{caller:l,accepted:!1}}),m(""),C(!1),x(!1),a("")},E=d=>{if(d.preventDefault(),!n.connected){w.error({description:"You should register first!"});return}c(!0),v.send(n,{type:"call-offer",content:{target:o}})},p=d=>{const{type:Z,content:B,success:U}=d;switch(Z){case"socket-connect":D(U);break;case"call-offer":U?B.cancelling?(m(""),x(!1),N.swalBootstrapBtn.close()):(m(B.caller),x(!0)):(c(!1),w.error({description:B.description}),N.swalBootstrapBtn.close());break;case"call-answer":U?(N.swalBootstrapBtn.close(),x(!1),C(B.accepted),c(!1)):w.error({description:B.description});break}};e.useEffect(()=>(n.on("response",p),()=>{n.off("response",p)}),[]),e.useEffect(()=>{u&&N.dialingCall({partner:o,onCancel:f})},[u,c]),e.useEffect(()=>{g&&N.incomingCall({partner:l,onAccept:b,onDeny:h})},[g,x]),e.useEffect(()=>{T&&t.replace("/room",{isCaller:!!u})},[T,C]);const X=()=>{const d=se(Re);s(d)};return e.createElement(e.Fragment,null,e.createElement(W,null,e.createElement("title",null,"ChatSignal Home")),e.createElement("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 px-6 lg:px-8"},e.createElement("div",{className:"sm:mx-auto sm:w-full sm:max-w-md"},e.createElement("img",{className:"mx-auto h-12 w-auto",src:"/images/webrtc_logo.svg",alt:"webrtc chat"}),e.createElement("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900"},!!y&&!!r?e.createElement(e.Fragment,null,"Hi\xA0",e.createElement("span",{className:"text-indigo-500"},r)):"Set a username"),!!y&&!!r?e.createElement("p",{className:"text-center text-sm font-medium text-gray-700"},"Try to call someone or wait them to call you"):null),!!y&&!!r?e.createElement(J,{name:o,handleInputChange:i,buttonAction:E,buttonText:"Call",labelText:"Friend username",placeholder:"e.g. pepsicola",isUserForm:!1}):e.createElement(J,{name:r,handleInputChange:_,buttonAction:F,buttonText:"Continue",labelText:"Username",placeholder:"e.g. cocacola",isUserForm:!0,generateUsername:X})))},Ne={iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]},Te=({location:{state:t},history:n})=>{const{friendname:r,updateFriendname:o}=j(),{socket:s}=$(),[a,l]=e.useState(t.isCaller),m=e.useRef(null),u=e.useRef(null),c=e.useRef(),g=e.useRef();function x(i){i.candidate&&v.send(s,{type:"ice-candidate",content:{friendname:r,candidate:i.candidate}})}function T(i){u.current.srcObject=i.streams[0]}function C(){const i=new RTCPeerConnection(Ne);return i.onicecandidate=x,i.ontrack=T,i}function y(){u.current.srcObject=null,c.current.close(),c.current.onicecandidate=null,c.current.ontrack=null,g.current.getTracks().forEach(i=>{i.stop()}),g.current=void 0,c.current=void 0,o(""),n.replace("/")}const D=i=>{const{type:f,success:b,content:h}=i;switch(f){case"peer-offer":if(b){c.current=C();const E=new RTCSessionDescription(h.offer);c.current.setRemoteDescription(E).then(()=>{g.current.getTracks().forEach(p=>{c.current.addTrack(p,g.current)})}).then(()=>c.current.createAnswer()).then(p=>c.current.setLocalDescription(p)).then(()=>{v.send(s,{type:"peer-answer",content:{caller:r,answer:c.current.localDescription}})}).catch(p=>console.log(p))}else w.error({description:h.description});break;case"peer-answer":if(b){const E=new RTCSessionDescription(h.answer);c.current.setRemoteDescription(E).catch(p=>console.log(p))}else w.error({description:h.description});break;case"peer-leave":b?y():w.error({description:h.description});break;case"ice-candidate":if(b){const E=new RTCIceCandidate(h.candidate);c.current.addIceCandidate(E).catch(p=>console.log(p))}else w.error({description:h.description});break}};e.useEffect(()=>(navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(i=>{m.current.srcObject=i,g.current=i,a&&(c.current=C(),c.current.createOffer().then(f=>(c.current.setLocalDescription(f),{target:r,offer:f})).then(f=>{v.send(s,{type:"peer-offer",content:f})}).catch(f=>console.log(f)),g.current.getTracks().forEach(f=>{c.current.addTrack(f,g.current)})),s.on("response",D)}).catch(i=>{console.log(i)}),()=>{s.off("response",D)}),[]);function _(){v.send(s,{type:"peer-leave",content:{target:r}}),y()}const F=e.useRef(null);return e.createElement(e.Fragment,null,e.createElement(W,null,e.createElement("title",null,"Chat with\xA0",r)),e.createElement("div",{className:"w-screen h-screen bg-gray-300",ref:F},e.createElement(ae.div,{drag:!0,className:"absolute top-2 left-2 z-10",dragConstraints:F,dragElastic:.1,dragPropagation:!0},e.createElement("video",{autoPlay:!0,ref:m,className:"w-40  rounded-lg"},e.createElement("track",{kind:"captions"}))),e.createElement("div",{className:"flex items-center justify-center h-full w-full z-0 overflow-hidden"},e.createElement("video",{autoPlay:!0,ref:u,className:"sm:h-full"},e.createElement("track",{kind:"captions"}))),e.createElement("button",{className:"absolute bottom-6 left-[50%] translate-x-[-50%] z-20 p-0 w-12 h-12 bg-red-600 rounded-full hover:bg-red-700 active:shadow-lg mouse shadow transition ease-in duration-200 focus:outline-none",type:"button",onClick:_},e.createElement(ce,{className:"w-5 h-5 inline-block text-white"}))))},De=o=>{var s=o,{isAuthenticated:t,authenticationPath:n}=s,r=M(s,["isAuthenticated","authenticationPath"]);return t?e.createElement(q,k({},r)):e.createElement(le,{to:{pathname:n}})},Fe=()=>{const{socket:t}=$(),{username:n,friendname:r}=j(),o=t.connected===!0&&!!n&&!!r;return e.createElement(ie,null,e.createElement(ue,null,e.createElement(q,{exact:!0,path:"/",component:Be}),e.createElement(De,{isAuthenticated:o,authenticationPath:"/",path:"/room",component:Te})))},Oe=()=>e.createElement(Se,null,e.createElement(ye,null,e.createElement(Fe,null))),Ie="modulepreload",Q={},_e="/",Ue=function(n,r){return!r||r.length===0?n():Promise.all(r.map(o=>{if(o=`${_e}${o}`,o in Q)return;Q[o]=!0;const s=o.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const l=document.createElement("link");if(l.rel=s?"stylesheet":Ie,s||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),s)return new Promise((m,u)=>{l.addEventListener("load",m),l.addEventListener("error",u)})})).then(()=>n())},Le=t=>{t&&t instanceof Function&&Ue(()=>import("./web-vitals.es5.min.acaaa503.js"),[]).then(({getCLS:n,getFID:r,getFCP:o,getLCP:s,getTTFB:a})=>{n(t),r(t),o(t),s(t),a(t)})};Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ae(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()}).catch(t=>{console.error(t.message)})}de.render(e.createElement(e.StrictMode,null,e.createElement(me,null),e.createElement(Oe,null)),document.getElementById("root"));Ae();Le();
